{"ast":null,"code":"import _slicedToArray from \"/Users/lisasun/Documents/Dashboard/MondoDB/portal_new/stitch-tutorial-todo-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/lisasun/Documents/Dashboard/MondoDB/portal_new/stitch-tutorial-todo-web/src/components/GAMap.js\";\nimport React, { useEffect, useState } from 'react';\nimport { Container, Grid, Dropdown, Breadcrumb, Header, List, Loader, Divider, Image } from 'semantic-ui-react';\nimport { geoCentroid } from \"d3-geo\";\nimport Geographies from './Geographies';\nimport Geography from './Geography';\nimport ComposableMap from './ComposableMap'; //import Marker from './Marker';\n//import Annotation from './Annotation';\n\nimport ReactTooltip from \"react-tooltip\";\nimport { VictoryChart, VictoryGroup, VictoryBar, VictoryTheme, VictoryAxis, VictoryLegend, VictoryLine, VictoryLabel, VictoryScatter } from 'victory';\nimport { useHistory } from \"react-router-dom\";\nimport Notes from './Notes';\nimport _ from 'lodash';\nimport { scaleQuantile } from \"d3-scale\";\nimport configs from \"./state_config.json\";\nimport ReactDOM from 'react-dom';\n\nfunction numberWithCommas(x) {\n  x = x.toString();\n  var pattern = /(-?\\d+)(\\d{3})/;\n\n  while (pattern.test(x)) {\n    x = x.replace(pattern, \"$1,$2\");\n  }\n\n  return x;\n} //const geoUrl = \"https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json\";\n\n\nvar geoUrl = \"https://cdn.jsdelivr.net/npm/us-atlas@3/counties-10m.json\";\nvar colorPalette = [\"#e1dce2\", \"#d3b6cd\", \"#bf88b5\", \"#af5194\", \"#99528c\", \"#633c70\"];\nvar colorHighlight = '#f2a900';\n\nfunction MapLabels(props) {\n  var offsets = {\n    VT: [50, -8],\n    NH: [34, 2],\n    MA: [30, -1],\n    RI: [28, 2],\n    CT: [35, 10],\n    NJ: [34, 1],\n    DE: [33, 0],\n    MD: [47, 10],\n    DC: [49, 21]\n  };\n  return React.createElement(\"svg\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64\n    },\n    __self: this\n  }, props.geographies.map(function (geo) {\n    var centroid = geoCentroid(geo);\n    var cur = props.stateLabels.find(function (s) {\n      return s.val === geo.id;\n    });\n    return React.createElement(\"g\", {\n      key: geo.rsmKey + \"-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70\n      },\n      __self: this\n    }, cur && centroid[0] > -160 && centroid[0] < -67 && (Object.keys(offsets).indexOf(cur.id) === -1 ? React.createElement(Marker, {\n      coordinates: centroid,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75\n      },\n      __self: this\n    }, React.createElement(\"text\", {\n      y: \"2\",\n      fontSize: 14,\n      textAnchor: \"middle\",\n      fill: \"#eee\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76\n      },\n      __self: this\n    }, cur.id)) : React.createElement(Annotation, {\n      subject: centroid,\n      dx: offsets[cur.id][0],\n      dy: offsets[cur.id][1],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81\n      },\n      __self: this\n    }, React.createElement(\"text\", {\n      x: 4,\n      fontSize: 14,\n      alignmentBaseline: \"middle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, cur.id))));\n  }));\n}\n\nexport default function GAMap(props) {\n  var _useState = useState('Georgia'),\n      _useState2 = _slicedToArray(_useState, 2),\n      stateName = _useState2[0],\n      setStateName = _useState2[1];\n\n  var _useState3 = useState('13'),\n      _useState4 = _slicedToArray(_useState3, 2),\n      fips = _useState4[0],\n      setFips = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      tooltipContent = _useState6[0],\n      setTooltipContent = _useState6[1];\n\n  var history = useHistory();\n\n  var _useState7 = useState(),\n      _useState8 = _slicedToArray(_useState7, 2),\n      dataFltrd = _useState8[0],\n      setDataFltrd = _useState8[1];\n\n  var _useState9 = useState(),\n      _useState10 = _slicedToArray(_useState9, 2),\n      dataStateFltrd = _useState10[0],\n      setDataStateFltrd = _useState10[1];\n\n  var _useState11 = useState(),\n      _useState12 = _slicedToArray(_useState11, 2),\n      dataState = _useState12[0],\n      setDataState = _useState12[1];\n\n  var _useState13 = useState(),\n      _useState14 = _slicedToArray(_useState13, 2),\n      data = _useState14[0],\n      setData = _useState14[1];\n\n  var _useState15 = useState(''),\n      _useState16 = _slicedToArray(_useState15, 2),\n      date = _useState16[0],\n      setDate = _useState16[1];\n\n  var _useState17 = useState(),\n      _useState18 = _slicedToArray(_useState17, 2),\n      stateLabels = _useState18[0],\n      setStateLabels = _useState18[1];\n\n  var _useState19 = useState(),\n      _useState20 = _slicedToArray(_useState19, 2),\n      colorScale = _useState20[0],\n      setColorScale = _useState20[1];\n\n  var _useState21 = useState([]),\n      _useState22 = _slicedToArray(_useState21, 2),\n      legendMax = _useState22[0],\n      setLegendMax = _useState22[1];\n\n  var _useState23 = useState([]),\n      _useState24 = _slicedToArray(_useState23, 2),\n      legendMin = _useState24[0],\n      setLegendMin = _useState24[1];\n\n  var _useState25 = useState([]),\n      _useState26 = _slicedToArray(_useState25, 2),\n      legendSplit = _useState26[0],\n      setLegendSplit = _useState26[1];\n\n  var _useState27 = useState('mean7daycases'),\n      _useState28 = _slicedToArray(_useState27, 2),\n      metric = _useState28[0],\n      setMetric = _useState28[1];\n\n  var _useState29 = useState('mean7daycases'),\n      _useState30 = _slicedToArray(_useState29, 2),\n      metricOptions = _useState30[0],\n      setMetricOptions = _useState30[1];\n\n  var _useState31 = useState('Average Daily COVID-19 Cases'),\n      _useState32 = _slicedToArray(_useState31, 2),\n      metricName = _useState32[0],\n      setMetricName = _useState32[1];\n\n  var _useState33 = useState({}),\n      _useState34 = _slicedToArray(_useState33, 2),\n      varMap = _useState34[0],\n      setVarMap = _useState34[1];\n\n  var _useState35 = useState(),\n      _useState36 = _slicedToArray(_useState35, 2),\n      delayHandler = _useState36[0],\n      setDelayHandler = _useState36[1];\n\n  useEffect(function () {\n    fetch('/data/rawdata/variable_mapping.json').then(function (res) {\n      return res.json();\n    }).then(function (x) {\n      setVarMap(x);\n      setMetricOptions(_.filter(_.map(x, function (d) {\n        return {\n          key: d.id,\n          value: d.variable,\n          text: d.name,\n          group: d.group\n        };\n      }), function (d) {\n        return d.text !== \"Urban-Rural Status\" && d.group === \"outcomes\";\n      }));\n    });\n  }, []);\n  useEffect(function () {\n    if (metric) {\n      fetch('/data/data.json').then(function (res) {\n        return res.json();\n      }).then(function (x) {\n        setData(x);\n        setDataFltrd(_.filter(_.map(x, function (d, k) {\n          d.fips = k;\n          return d;\n        }), function (d) {\n          return d.Population > 10000 && d.black > 5 && d.fips.length === 5 && d['covidmortalityfig'] > 0;\n        }));\n        var cs = scaleQuantile().domain(_.map(_.filter(_.map(x, function (d, k) {\n          d.fips = k;\n          return d;\n        }), function (d) {\n          return d[metric] >= 0 && d.fips.length === 5;\n        }), function (d) {\n          return d[metric];\n        })).range(colorPalette);\n        var scaleMap = {};\n\n        _.each(x, function (d) {\n          if (d[metric] >= 0) {\n            scaleMap[d[metric]] = cs(d[metric]);\n          }\n        });\n\n        setColorScale(scaleMap);\n        var max = 0;\n        var min = 100;\n        var length = 0;\n\n        _.each(x, function (d) {\n          if (d[metric] > max && d.fips.length === 5) {\n            max = d[metric];\n          } else if (d.fips.length === 5 && d[metric] < min && d[metric] >= 0) {\n            min = d[metric];\n          }\n        });\n\n        if (max > 999999) {\n          max = (max / 1000000).toFixed(0) + \"M\";\n          setLegendMax(max);\n        } else if (max > 999) {\n          max = (max / 1000).toFixed(0) + \"K\";\n          setLegendMax(max);\n        } else {\n          setLegendMax(max.toFixed(0));\n        }\n\n        setLegendMin(min.toFixed(0));\n        var split = scaleQuantile().domain(_.map(_.filter(_.map(x, function (d, k) {\n          d.fips = k;\n          return d;\n        }), function (d) {\n          return d[metric] >= 0 && d.fips.length === 5;\n        }), function (d) {\n          return d[metric];\n        })).range(colorPalette);\n        setLegendSplit(split.quantiles());\n      });\n      fetch('/data/date.json').then(function (res) {\n        return res.json();\n      }).then(function (x) {\n        return setDate(x.date.substring(5, 7) + \"/\" + x.date.substring(8, 10) + \"/\" + x.date.substring(0, 4));\n      });\n      fetch('/data/allstates.json').then(function (res) {\n        return res.json();\n      }).then(function (x) {\n        return setStateLabels(x);\n      });\n      fetch('/data/data.json').then(function (res) {\n        return res.json();\n      }).then(function (x) {\n        setDataState(x);\n        setDataStateFltrd(_.filter(_.map(x, function (c, l) {\n          c.fips = l;\n          return c;\n        }), function (c) {\n          return c.fips.length === 2;\n        }));\n      });\n    }\n  }, [metric]);\n\n  if (data && dataFltrd && stateLabels && dataStateFltrd && dataState) {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(ComposableMap, {\n      projection: \"geoAlbersUsa\",\n      \"data-tip\": \"\",\n      width: 630,\n      height: 380,\n      strokeWidth: 0.1,\n      stroke: \"black\",\n      projectionConfig: {\n        scale: 750\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, React.createElement(Geographies, {\n      geography: geoUrl,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, function (_ref) {\n      var geographies = _ref.geographies;\n      return React.createElement(\"svg\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, geographies.map(function (geo) {\n        return React.createElement(Geography, {\n          key: geo.rsmKey,\n          geography: geo,\n          onMouseEnter: function onMouseEnter() {\n            //console.log(geo); \n            var stateFips = geo.id.substring(0, 2);\n            var configMatched = configs.find(function (s) {\n              return s.fips === stateFips;\n            });\n            setFips(stateFips);\n            setStateName(configMatched.name); //setStateName(geo.id.substring(0,2));\n            //setStateName(geo.properties.name); \n            //setTooltipContent()                            \n          },\n          onMouseLeave: function onMouseLeave() {\n            setTooltipContent(\"\");\n          },\n          onClick: function onClick() {\n            history.push(\"/\" + geo.id.substring(0, 2) + \"\");\n          },\n          fill: fips === geo.id.substring(0, 2) ? colorHighlight : colorScale && data[geo.id] && data[geo.id][metric] > 0 ? colorScale[data[geo.id][metric]] : colorScale && data[geo.id] && data[geo.id][metric] === 0 ? '#e1dce2' : '#FFFFFF',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 244\n          },\n          __self: this\n        });\n      }), React.createElement(MapLabels, {\n        geographies: geographies,\n        stateLabels: stateLabels,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279\n        },\n        __self: this\n      }));\n    })));\n  } else {\n    return React.createElement(Loader, {\n      active: true,\n      inline: \"centered\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291\n      },\n      __self: this\n    });\n  }\n}","map":{"version":3,"sources":["/Users/lisasun/Documents/Dashboard/MondoDB/portal_new/stitch-tutorial-todo-web/src/components/GAMap.js"],"names":["React","useEffect","useState","Container","Grid","Dropdown","Breadcrumb","Header","List","Loader","Divider","Image","geoCentroid","Geographies","Geography","ComposableMap","ReactTooltip","VictoryChart","VictoryGroup","VictoryBar","VictoryTheme","VictoryAxis","VictoryLegend","VictoryLine","VictoryLabel","VictoryScatter","useHistory","Notes","_","scaleQuantile","configs","ReactDOM","numberWithCommas","x","toString","pattern","test","replace","geoUrl","colorPalette","colorHighlight","MapLabels","props","offsets","VT","NH","MA","RI","CT","NJ","DE","MD","DC","geographies","map","geo","centroid","cur","stateLabels","find","s","val","id","rsmKey","Object","keys","indexOf","GAMap","stateName","setStateName","fips","setFips","tooltipContent","setTooltipContent","history","dataFltrd","setDataFltrd","dataStateFltrd","setDataStateFltrd","dataState","setDataState","data","setData","date","setDate","setStateLabels","colorScale","setColorScale","legendMax","setLegendMax","legendMin","setLegendMin","legendSplit","setLegendSplit","metric","setMetric","metricOptions","setMetricOptions","metricName","setMetricName","varMap","setVarMap","delayHandler","setDelayHandler","fetch","then","res","json","filter","d","key","value","variable","text","name","group","k","Population","black","length","cs","domain","range","scaleMap","each","max","min","toFixed","split","quantiles","substring","c","l","scale","stateFips","configMatched","push"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { Container, Grid, Dropdown, Breadcrumb, Header, List, Loader, Divider, Image } from 'semantic-ui-react'\nimport { geoCentroid } from \"d3-geo\";\nimport Geographies from './Geographies';\nimport Geography from './Geography';\nimport ComposableMap from './ComposableMap';\n//import Marker from './Marker';\n//import Annotation from './Annotation';\nimport ReactTooltip from \"react-tooltip\";\nimport { VictoryChart, \n  VictoryGroup, \n  VictoryBar, \n  VictoryTheme, \n  VictoryAxis, \n  VictoryLegend,\n  VictoryLine,  \n  VictoryLabel, \n  VictoryScatter,\n} from 'victory';\nimport { useHistory } from \"react-router-dom\";\nimport Notes from './Notes';\nimport _ from 'lodash';\nimport { scaleQuantile } from \"d3-scale\";\nimport configs from \"./state_config.json\";\nimport ReactDOM from 'react-dom';\n\n\nfunction numberWithCommas(x) {\n    x = x.toString();\n    var pattern = /(-?\\d+)(\\d{3})/;\n    while (pattern.test(x))\n        x = x.replace(pattern, \"$1,$2\");\n    return x;\n}\n\n//const geoUrl = \"https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json\";\nconst geoUrl = \"https://cdn.jsdelivr.net/npm/us-atlas@3/counties-10m.json\"\nconst colorPalette = [\n        \"#e1dce2\",\n        \"#d3b6cd\",\n        \"#bf88b5\", \n        \"#af5194\", \n        \"#99528c\", \n        \"#633c70\", \n      ];\nconst colorHighlight = '#f2a900';\n\n\nfunction MapLabels(props){\n\n  const offsets = {\n    VT: [50, -8],\n    NH: [34, 2],\n    MA: [30, -1],\n    RI: [28, 2],\n    CT: [35, 10],\n    NJ: [34, 1],\n    DE: [33, 0],\n    MD: [47, 10],\n    DC: [49, 21],\n  };\n\n  return (\n    <svg>\n\n      {props.geographies.map(geo => {\n          const centroid = geoCentroid(geo);\n          const cur = props.stateLabels.find(s => s.val === geo.id);\n          return (\n            <g key={geo.rsmKey + \"-name\"}>\n              {cur &&\n                centroid[0] > -160 &&\n                centroid[0] < -67 &&\n                (Object.keys(offsets).indexOf(cur.id) === -1 ? (\n                  <Marker coordinates={centroid}>\n                    <text y=\"2\" fontSize={14} textAnchor=\"middle\" fill=\"#eee\">\n                      {cur.id}\n                    </text>\n                  </Marker>\n                ) : (\n                  <Annotation\n                    subject={centroid}\n                    dx={offsets[cur.id][0]}\n                    dy={offsets[cur.id][1]}\n                  >\n                    <text x={4} fontSize={14} alignmentBaseline=\"middle\">\n                      {cur.id}\n                    </text>\n                  </Annotation>\n                ))}\n            </g>\n          );\n        })}\n    </svg>\n    );\n}\n\n\nexport default function GAMap(props) {\n\n  const [stateName, setStateName] = useState('Georgia');\n  const [fips, setFips] = useState('13');\n  const [tooltipContent, setTooltipContent] = useState('');\n  const history = useHistory();\n  const [dataFltrd, setDataFltrd] = useState();\n\n  const [dataStateFltrd, setDataStateFltrd] = useState();\n  const [dataState, setDataState] = useState();\n\n  const [data, setData] = useState();\n  const [date, setDate] = useState('');\n  const [stateLabels, setStateLabels] = useState();\n  const [colorScale, setColorScale] = useState();\n\n  const [legendMax, setLegendMax] = useState([]);\n  const [legendMin, setLegendMin] = useState([]);\n  const [legendSplit, setLegendSplit] = useState([]);\n\n  const [metric, setMetric] = useState('mean7daycases');\n  const [metricOptions, setMetricOptions] = useState('mean7daycases');\n  const [metricName, setMetricName] = useState('Average Daily COVID-19 Cases');\n\n  const [varMap, setVarMap] = useState({});\n  const [delayHandler, setDelayHandler] = useState();\n\n\n  useEffect(()=>{\n    fetch('/data/rawdata/variable_mapping.json').then(res => res.json())\n      .then(x => {\n        setVarMap(x);\n        setMetricOptions(_.filter(_.map(x, d=> {\n          return {key: d.id, value: d.variable, text: d.name, group: d.group};\n        }), d => (d.text !== \"Urban-Rural Status\" && d.group === \"outcomes\")));\n      });\n  }, []);\n\n\n\n\n  useEffect(() => {\n    if (metric) {\n    fetch('/data/data.json').then(res => res.json())\n      .then(x => {\n        \n        setData(x);\n        setDataFltrd(_.filter(_.map(x, (d, k) => {\n          d.fips = k\n          return d}), \n          d => (d.Population > 10000 && \n              d.black > 5 && \n              d.fips.length === 5 && \n              d['covidmortalityfig'] > 0)));\n      \n        const cs = scaleQuantile()\n        .domain(_.map(_.filter(_.map(x, (d, k) => {\n          d.fips = k\n          return d}), \n          d => (\n              d[metric] >= 0 &&\n              d.fips.length === 5)),\n          d=> d[metric]))\n        .range(colorPalette);\n\n        let scaleMap = {}\n        _.each(x, d=>{\n          if(d[metric] >= 0){\n          scaleMap[d[metric]] = cs(d[metric])}});\n      \n        setColorScale(scaleMap);\n        var max = 0\n        var min = 100\n        var length = 0\n        _.each(x, d=> { \n          if (d[metric] > max && d.fips.length === 5) {\n            max = d[metric]\n          } else if (d.fips.length === 5 && d[metric] < min && d[metric] >= 0){\n            min = d[metric]\n          }\n        });\n\n        if (max > 999999) {\n          max = (max/1000000).toFixed(0) + \"M\";\n          setLegendMax(max);\n        }else if (max > 999) {\n          max = (max/1000).toFixed(0) + \"K\";\n          setLegendMax(max);\n        }else{\n          setLegendMax(max.toFixed(0));\n\n        }\n        setLegendMin(min.toFixed(0));\n\n        var split = scaleQuantile()\n        .domain(_.map(_.filter(_.map(x, (d, k) => {\n          d.fips = k\n          return d}), \n          d => (\n              d[metric] >= 0 &&\n              d.fips.length === 5)),\n          d=> d[metric]))\n        .range(colorPalette);\n\n        setLegendSplit(split.quantiles());\n\n\n      });\n\n    fetch('/data/date.json').then(res => res.json())\n      .then(x => setDate(x.date.substring(5,7) + \"/\" + x.date.substring(8,10) + \"/\" + x.date.substring(0,4)));\n    \n    fetch('/data/allstates.json').then(res => res.json())\n      .then(x => setStateLabels(x));\n\n    fetch('/data/data.json').then(res => res.json())\n      .then(x => {\n        setDataState(x);\n        setDataStateFltrd(_.filter(_.map(x, (c, l) => {\n          c.fips = l\n          return c}),\n          c => (c.fips.length === 2)));\n      });\n    }\n\n  }, [metric])\n\n  if (data && dataFltrd && stateLabels && dataStateFltrd && dataState) {\n\n  return (\n      <div>\n              \n        <ComposableMap \n          projection=\"geoAlbersUsa\" \n          data-tip=\"\"\n          width={630} \n          height={380}\n          strokeWidth= {0.1}\n          stroke= 'black'\n          projectionConfig={{scale: 750}}\n           >\n          <Geographies geography={geoUrl}>\n            {({ geographies }) => \n              <svg>\n                {geographies.map(geo => (\n                  <Geography\n                    key={geo.rsmKey}\n                    geography={geo}\n                    onMouseEnter={()=>{\n\n                      //console.log(geo); \n                      const stateFips = geo.id.substring(0,2);\n                      const configMatched = configs.find(s => s.fips === stateFips);\n\n                      setFips(stateFips);\n                      setStateName(configMatched.name);\n                      //setStateName(geo.id.substring(0,2));\n                      //setStateName(geo.properties.name); \n                      //setTooltipContent()                            \n                    \n                    }}\n\n\n\n                    onMouseLeave={()=>{\n                      setTooltipContent(\"\")\n                    }}\n                    onClick={()=>{\n                      history.push(\"/\"+geo.id.substring(0,2)+\"\");\n                    }}\n\n                    \n                    fill={fips===geo.id.substring(0,2)?colorHighlight:\n                    ((colorScale && data[geo.id] && (data[geo.id][metric]) > 0)?\n                        colorScale[data[geo.id][metric]]: \n                        (colorScale && data[geo.id] && data[geo.id][metric] === 0)?\n                          '#e1dce2':'#FFFFFF')}\n                    \n                  />\n                ))}\n                <MapLabels geographies={geographies} stateLabels={stateLabels} />\n              </svg>\n            }\n          </Geographies>\n          \n\n        </ComposableMap>\n                \n        \n      </div>\n      );\n  } else {\n    return <Loader active inline='centered' />\n  }\n}"]},"metadata":{},"sourceType":"module"}