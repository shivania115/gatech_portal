{"ast":null,"code":"import * as d3 from \"d3\";\n\nvar Chart = function Chart(opts) {\n  this.data = opts.data;\n  this.ga = opts.ga;\n  this.element = opts.element;\n  this.draw();\n};\n\nChart.prototype.draw = function () {\n  this.width = this.element.offsetWidth;\n  this.height = this.width * 1.1;\n\n  if (this.data.has(\"unit\")) {\n    var unitStr = this.data.get(\"unit\").split(\"-\");\n    this.unit = unitStr[0];\n    this.fmt = unitStr[1];\n    this.data.remove(\"unit\");\n    this.data.each(function (value, key, data) {\n      data.set(key, +value);\n    });\n  }\n\n  this.setProjection();\n  this.setColor();\n  this.addTooltip();\n\n  if (this.data.keys()[0] > 100000) {\n    this.drawTract();\n  } else {\n    this.drawCounty();\n  } // this.addLegend();\n\n\n  this.addContinousLegend();\n};\n\nChart.prototype.setProjection = function () {\n  this.projection = d3.geoTransverseMercator().rotate([84 + 10 / 60, -30]).scale(this.width * 13).translate([this.width / 3.1, this.height / 0.95]);\n  this.path = d3.geoPath().projection(this.projection);\n};\n\nChart.prototype.setColor = function () {\n  // this.color = d3.scaleQuantize()\n  //     .domain(d3.extent(this.data.values()))\n  //     .range([\"#DEEDCF\", \"#BFE1B0\", \"#99D492\", \"#74C67A\", \"#56B870\", \"#39A96B\"]);\n  // .range(d3.schemeBlues[6]);\n  this.color = d3.scaleLinear().range([\"#DEEDCF\", \"#39A96B\"]).domain(d3.extent(this.data.values())).interpolate(d3.interpolateLab);\n};\n\nChart.prototype.addTooltip = function () {\n  var _this = this;\n\n  d3.selectAll(\".d3-tip-\" + this.element.id).remove();\n  this.tip = d3.tip().attr(\"class\", \"d3-tip-\" + this.element.id).html(function (d) {\n    if (+d.properties.GEOID < 100000) {\n      return d.properties.NAME + \" County</br>\" + d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit + \"</br> (click for more details)\";\n    } else {\n      return d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit;\n    }\n  });\n};\n\nChart.prototype.drawTract = function () {\n  var _this = this;\n\n  this.element.innerHTML = '';\n  this.svg = d3.select(this.element).append('svg');\n  this.svg.attr('width', this.width);\n  this.svg.attr('height', this.height);\n  this.svg.call(this.tip);\n  this.svg.append(\"g\").attr(\"class\", \"tract\").selectAll(\"path\").data(topojson.feature(this.ga, this.ga.objects.tract).features).enter().append(\"path\").attr(\"fill\", function (d) {\n    return _this.color(_this.data.get(d.properties.GEOID));\n  }).attr(\"d\", this.path); // .on(\"mouseover\", this.tip.show)\n  // .on(\"mouseout\", this.tip.hide);\n\n  this.svg.append(\"path\").datum(topojson.mesh(this.ga, this.ga.objects.county, function (a, b) {\n    return a != b;\n  })).attr(\"class\", \"county\").attr(\"d\", this.path);\n};\n\nChart.prototype.drawCounty = function () {\n  var _this = this;\n\n  this.element.innerHTML = '';\n  this.svg = d3.select(this.element).append('svg');\n  this.svg.attr('width', this.width);\n  this.svg.attr('height', this.height);\n  this.svg.call(this.tip);\n  this.svg.append(\"g\").attr(\"class\", \"county\").selectAll(\"path\").data(topojson.feature(this.ga, this.ga.objects.county).features).enter().append(\"path\").attr(\"fill\", function (d) {\n    return _this.color(_this.data.get(d.properties.GEOID));\n  }).attr(\"d\", this.path).on(\"mouseover\", this.tip.show).on(\"mouseout\", this.tip.hide).on(\"click\", function (d) {\n    console.log(d.properties.GEOID);\n    window.open(\"js/tabulate.html?GEOID=\" + d.properties.GEOID + \"=name=\" + d.properties.NAME);\n  });\n};\n\nChart.prototype.addContinousLegend = function () {\n  var colorScale1 = d3.scaleLinear().range([\"#DEEDCF\", \"#39A96B\"]).domain(d3.extent(this.data.values())).interpolate(d3.interpolateLab);\n  continuous(\"#legend1\", colorScale1); // create continuous color legend\n\n  function continuous(selector_id, colorscale) {\n    var legendheight = 200,\n        legendwidth = 80,\n        margin = {\n      top: 10,\n      right: 60,\n      bottom: 10,\n      left: 2\n    };\n    d3.select(selector_id).selectAll(\"*\").remove();\n    var canvas = d3.select(selector_id).style(\"height\", legendheight + \"px\").style(\"width\", legendwidth + \"px\").style(\"position\", \"relative\").append(\"canvas\").attr(\"height\", legendheight - margin.top - margin.bottom).attr(\"width\", 1).style(\"height\", legendheight - margin.top - margin.bottom + \"px\").style(\"width\", legendwidth - margin.left - margin.right + \"px\").style(\"border\", \"1px solid #000\").style(\"position\", \"absolute\").style(\"top\", margin.top + \"px\").style(\"left\", margin.left + \"px\").node();\n    var ctx = canvas.getContext(\"2d\");\n    var legendscale = d3.scaleLinear().range([1, legendheight - margin.top - margin.bottom]).domain(colorscale.domain()); // image data hackery based on http://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5\n\n    var image = ctx.createImageData(1, legendheight);\n    d3.range(legendheight).forEach(function (i) {\n      var c = d3.rgb(colorscale(legendscale.invert(i)));\n      image.data[4 * i] = c.r;\n      image.data[4 * i + 1] = c.g;\n      image.data[4 * i + 2] = c.b;\n      image.data[4 * i + 3] = 255;\n    });\n    ctx.putImageData(image, 0, 0);\n    var legendaxis = d3.axisRight().scale(legendscale).tickSize(6).ticks(8);\n    var svg = d3.select(selector_id).append(\"svg\").attr(\"height\", legendheight + \"px\").attr(\"width\", legendwidth + 10 + \"px\").style(\"position\", \"absolute\").style(\"left\", \"0px\").style(\"top\", \"0px\");\n    svg.append(\"g\").attr(\"class\", \"axis\").attr(\"transform\", \"translate(\" + (legendwidth - margin.left - margin.right + 3) + \",\" + margin.top + \")\").call(legendaxis);\n    svg.append(\"text\").attr(\"x\", 50).attr(\"y\", 190).text(\"highest\").style(\"font-size\", \"12px\").style('fill', \"black\").attr(\"alignment-baseline\", \"middle\");\n    svg.append(\"text\").attr(\"x\", 50).attr(\"y\", 15).text(\"lowest\").style(\"font-size\", \"12px\").style('fill', \"black\").attr(\"alignment-baseline\", \"middle\");\n  }\n};\n\nChart.prototype.addLegend = function () {\n  var _this = this;\n\n  this.legend = this.svg.selectAll(\"g.legendEntry\").data(this.color.range().reverse()).enter().append(\"g\").attr(\"class\", \"legendEntry\");\n  this.legend.append(\"rect\").attr(\"x\", this.width / 1.5).attr(\"y\", function (d, i) {\n    return i * 20 + 10;\n  }).attr(\"width\", 15).attr(\"height\", 15).style(\"stroke\", \"black\").style(\"stroke-width\", 1).style(\"fill\", function (d) {\n    return d;\n  });\n  this.legend.append(\"text\").attr(\"x\", this.width / 1.5 + 20).attr(\"y\", function (d, i) {\n    return i * 20 + 12;\n  }).attr(\"dy\", \"0.8em\").text(function (d, i) {\n    var extent = _this.color.invertExtent(d);\n\n    var format = d3.format(_this.fmt);\n    return format(+extent[0]) + \" - \" + format(+extent[1]) + \" \" + _this.unit;\n  });\n};\n\nChart.prototype.setData = function (data) {\n  this.data = data;\n  this.draw();\n};","map":{"version":3,"sources":["/Users/lisasun/Documents/Dashboard/MondoDB/portal_new/stitch-tutorial-todo-web/src/components/map.js"],"names":["d3","Chart","opts","data","ga","element","draw","prototype","width","offsetWidth","height","has","unitStr","get","split","unit","fmt","remove","each","value","key","set","setProjection","setColor","addTooltip","keys","drawTract","drawCounty","addContinousLegend","projection","geoTransverseMercator","rotate","scale","translate","path","geoPath","color","scaleLinear","range","domain","extent","values","interpolate","interpolateLab","_this","selectAll","id","tip","attr","html","d","properties","GEOID","NAME","format","innerHTML","svg","select","append","call","topojson","feature","objects","tract","features","enter","datum","mesh","county","a","b","on","show","hide","console","log","window","open","colorScale1","continuous","selector_id","colorscale","legendheight","legendwidth","margin","top","right","bottom","left","canvas","style","node","ctx","getContext","legendscale","image","createImageData","forEach","i","c","rgb","invert","r","g","putImageData","legendaxis","axisRight","tickSize","ticks","text","addLegend","legend","reverse","invertExtent","setData"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\"\n\nvar Chart = function(opts) {\n    this.data = opts.data;\n    this.ga = opts.ga;\n    this.element = opts.element;\n\n    this.draw();\n};\n\nChart.prototype.draw = function() {\n    this.width = this.element.offsetWidth;\n    this.height = this.width * 1.1;\n\n    if (this.data.has(\"unit\")) {\n        var unitStr = this.data.get(\"unit\").split(\"-\");\n        this.unit = unitStr[0];\n        this.fmt = unitStr[1];\n        this.data.remove(\"unit\");\n\n        this.data.each(function(value, key, data) { data.set(key, +value); });\n    }\n\n    this.setProjection();\n    this.setColor();\n    this.addTooltip();\n\n    if (this.data.keys()[0] > 100000) {\n        this.drawTract();\n    } else {\n        this.drawCounty();\n    }\n\n    // this.addLegend();\n    this.addContinousLegend();\n\n};\n\nChart.prototype.setProjection = function() {\n    this.projection = d3.geoTransverseMercator()\n        .rotate([84 + 10 / 60, -30])\n        .scale(this.width * 13)\n        .translate([this.width / 3.1, this.height / 0.95]);\n\n    this.path = d3.geoPath()\n        .projection(this.projection);\n};\n\nChart.prototype.setColor = function() {\n    // this.color = d3.scaleQuantize()\n    //     .domain(d3.extent(this.data.values()))\n    //     .range([\"#DEEDCF\", \"#BFE1B0\", \"#99D492\", \"#74C67A\", \"#56B870\", \"#39A96B\"]);\n        // .range(d3.schemeBlues[6]);\n    this.color = d3.scaleLinear()\n          .range([\"#DEEDCF\", \"#39A96B\"])\n          .domain(d3.extent(this.data.values()))\n          .interpolate(d3.interpolateLab);\n\n\n};\n\nChart.prototype.addTooltip = function() {\n    var _this = this;\n    d3.selectAll(\".d3-tip-\" + this.element.id).remove();\n\n    this.tip = d3.tip()\n        .attr(\"class\", \"d3-tip-\" + this.element.id)\n        .html(function(d) {\n            if (+d.properties.GEOID < 100000) {\n                return d.properties.NAME + \" County</br>\" + d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit + \"</br> (click for more details)\";\n            } else {\n                return d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit;\n            }\n        });\n};\n\nChart.prototype.drawTract = function() {\n    var _this = this;\n\n    this.element.innerHTML = '';\n    this.svg = d3.select(this.element).append('svg');\n    this.svg.attr('width', this.width);\n    this.svg.attr('height', this.height);\n    this.svg.call(this.tip);\n\n    this.svg.append(\"g\")\n        .attr(\"class\", \"tract\")\n        .selectAll(\"path\")\n        .data(topojson.feature(this.ga, this.ga.objects.tract).features)\n        .enter().append(\"path\")\n        .attr(\"fill\", function(d) { return _this.color(_this.data.get(d.properties.GEOID)); })\n        .attr(\"d\", this.path)\n        // .on(\"mouseover\", this.tip.show)\n        // .on(\"mouseout\", this.tip.hide);\n\n    this.svg.append(\"path\")\n        .datum(topojson.mesh(this.ga, this.ga.objects.county, function(a, b) { return a != b; }))\n        .attr(\"class\", \"county\")\n        .attr(\"d\", this.path);\n};\n\nChart.prototype.drawCounty = function() {\n    var _this = this;\n\n    this.element.innerHTML = '';\n    this.svg = d3.select(this.element).append('svg');\n    this.svg.attr('width', this.width);\n    this.svg.attr('height', this.height);\n    this.svg.call(this.tip);\n\n    this.svg.append(\"g\")\n        .attr(\"class\", \"county\")\n        .selectAll(\"path\")\n        .data(topojson.feature(this.ga, this.ga.objects.county).features)\n        .enter().append(\"path\")\n        .attr(\"fill\", function(d) { return _this.color(_this.data.get(d.properties.GEOID)); })\n        .attr(\"d\", this.path)\n        .on(\"mouseover\", this.tip.show)\n        .on(\"mouseout\", this.tip.hide)\n        .on(\"click\", function(d) {\n            console.log(d.properties.GEOID);\n            window.open(\"js/tabulate.html?GEOID=\" + d.properties.GEOID+ \"=name=\" + d.properties.NAME); });\n};\n\nChart.prototype.addContinousLegend = function() {\n    var colorScale1 = d3\n        .scaleLinear()\n          .range([\"#DEEDCF\", \"#39A96B\"])\n          .domain(d3.extent(this.data.values()))\n          .interpolate(d3.interpolateLab);\n    continuous(\"#legend1\", colorScale1);\n    // create continuous color legend\n    function continuous(selector_id, colorscale) {\n      var legendheight = 200,\n          legendwidth = 80,\n          margin = {top: 10, right: 60, bottom: 10, left: 2};\n    d3.select(selector_id).selectAll(\"*\").remove();\n\n      var canvas = d3.select(selector_id)\n        .style(\"height\", legendheight + \"px\")\n        .style(\"width\", legendwidth + \"px\")\n        .style(\"position\", \"relative\")\n        .append(\"canvas\")\n        .attr(\"height\", legendheight - margin.top - margin.bottom)\n        .attr(\"width\", 1)\n        .style(\"height\", (legendheight - margin.top - margin.bottom) + \"px\")\n        .style(\"width\", (legendwidth - margin.left - margin.right) + \"px\")\n        .style(\"border\", \"1px solid #000\")\n        .style(\"position\", \"absolute\")\n        .style(\"top\", (margin.top) + \"px\")\n        .style(\"left\", (margin.left) + \"px\")\n        .node();\n\n\n      var ctx = canvas.getContext(\"2d\");\n\n      var legendscale = d3.scaleLinear()\n        .range([1, legendheight - margin.top - margin.bottom])\n        .domain(colorscale.domain());\n\n      // image data hackery based on http://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5\n      var image = ctx.createImageData(1, legendheight);\n      d3.range(legendheight).forEach(function(i) {\n        var c = d3.rgb(colorscale(legendscale.invert(i)));\n        image.data[4*i] = c.r;\n        image.data[4*i + 1] = c.g;\n        image.data[4*i + 2] = c.b;\n        image.data[4*i + 3] = 255;\n      });\n      ctx.putImageData(image, 0, 0);\n\n      var legendaxis = d3.axisRight()\n        .scale(legendscale)\n        .tickSize(6)\n        .ticks(8);\n\n      var svg = d3.select(selector_id)\n        .append(\"svg\")\n        .attr(\"height\", (legendheight) + \"px\")\n        .attr(\"width\", (legendwidth + 10) + \"px\")\n        .style(\"position\", \"absolute\")\n        .style(\"left\", \"0px\")\n        .style(\"top\", \"0px\")\n\n      svg\n        .append(\"g\")\n        .attr(\"class\", \"axis\")\n        .attr(\"transform\", \"translate(\" + (legendwidth - margin.left - margin.right + 3) + \",\" + (margin.top) + \")\")\n        .call(legendaxis);\n\n      svg\n        .append(\"text\")\n        .attr(\"x\", 50)\n        .attr(\"y\", 190)\n        .text(\"highest\")\n        .style(\"font-size\", \"12px\")\n        .style('fill', \"black\")\n        .attr(\"alignment-baseline\",\"middle\");\n\n      svg\n      .append(\"text\")\n      .attr(\"x\", 50)\n      .attr(\"y\", 15)\n      .text(\"lowest\")\n      .style(\"font-size\", \"12px\")\n      .style('fill', \"black\")\n      .attr(\"alignment-baseline\",\"middle\");\n    }\n}\n\nChart.prototype.addLegend = function() {\n    var _this = this;\n\n    this.legend = this.svg.selectAll(\"g.legendEntry\")\n        .data(this.color.range().reverse())\n        .enter()\n        .append(\"g\").attr(\"class\", \"legendEntry\");\n\n    this.legend.append(\"rect\")\n        .attr(\"x\", this.width / 1.5)\n        .attr(\"y\", function(d, i) {\n            return i * 20 + 10;\n        })\n        .attr(\"width\", 15)\n        .attr(\"height\", 15)\n        .style(\"stroke\", \"black\")\n        .style(\"stroke-width\", 1)\n        .style(\"fill\", function(d) {return d;});\n\n    this.legend.append(\"text\")\n        .attr(\"x\", this.width / 1.5 + 20)\n        .attr(\"y\", function(d, i) {\n            return i * 20 + 12;\n        })\n        .attr(\"dy\", \"0.8em\")\n        .text(function(d, i) {\n            var extent = _this.color.invertExtent(d);\n            var format = d3.format(_this.fmt);\n            return format(+extent[0]) + \" - \" + format(+extent[1]) + \" \" + _this.unit;\n        });\n};\n\nChart.prototype.setData = function(data) {\n    this.data = data;\n    this.draw();\n};\n"]},"metadata":{},"sourceType":"module"}