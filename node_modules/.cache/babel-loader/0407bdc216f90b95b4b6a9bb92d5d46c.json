{"ast":null,"code":"import * as d3 from \"d3\";\nimport \"./topojson.v2.min\";\n\nvar Chart = function Chart(opts) {\n  this.data = opts.data;\n  this.ga = opts.ga;\n  this.element = opts.element;\n  this.draw();\n};\n\nChart.prototype.draw = function () {\n  this.width = this.element.offsetWidth;\n  this.height = this.width * 1.1;\n\n  if (this.data.has(\"unit\")) {\n    var unitStr = this.data.get(\"unit\").split(\"-\");\n    this.unit = unitStr[0];\n    this.fmt = unitStr[1];\n    this.data.remove(\"unit\");\n    this.data.each(function (value, key, data) {\n      data.set(key, +value);\n    });\n  }\n\n  this.setProjection();\n  this.setColor();\n  this.addTooltip();\n\n  if (this.data.keys()[0] > 100000) {\n    this.drawTract();\n  } else {\n    this.drawCounty();\n  } // this.addLegend();\n\n\n  this.addContinousLegend();\n};\n\nChart.prototype.setProjection = function () {\n  this.projection = d3.geoTransverseMercator().rotate([84 + 10 / 60, -30]).scale(this.width * 13).translate([this.width / 3.1, this.height / 0.95]);\n  this.path = d3.geoPath().projection(this.projection);\n};\n\nChart.prototype.setColor = function () {\n  // this.color = d3.scaleQuantize()\n  //     .domain(d3.extent(this.data.values()))\n  //     .range([\"#DEEDCF\", \"#BFE1B0\", \"#99D492\", \"#74C67A\", \"#56B870\", \"#39A96B\"]);\n  // .range(d3.schemeBlues[6]);\n  this.color = d3.scaleLinear().range([\"#DEEDCF\", \"#39A96B\"]).domain(d3.extent(this.data.values())).interpolate(d3.interpolateLab);\n}; // Chart.prototype.addTooltip = function() {\n//     var _this = this;\n//     d3.selectAll(\".d3-tip-\" + this.element.id).remove();\n//     this.tip = d3.tip()\n//         .attr(\"class\", \"d3-tip-\" + this.element.id)\n//         .html(function(d) {\n//             if (+d.properties.GEOID < 100000) {\n//                 return d.properties.NAME + \" County</br>\" + d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit + \"</br> (click for more details)\";\n//             } else {\n//                 return d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit;\n//             }\n//         });\n// };\n\n\nChart.prototype.drawTract = function () {\n  var _this = this;\n\n  this.element.innerHTML = '';\n  this.svg = d3.select(this.element).append('svg');\n  this.svg.attr('width', this.width);\n  this.svg.attr('height', this.height);\n  this.svg.call(this.tip);\n  this.svg.append(\"g\").attr(\"class\", \"tract\").selectAll(\"path\").data(topojson.feature(this.ga, this.ga.objects.tract).features).enter().append(\"path\").attr(\"fill\", function (d) {\n    return _this.color(_this.data.get(d.properties.GEOID));\n  }).attr(\"d\", this.path); // .on(\"mouseover\", this.tip.show)\n  // .on(\"mouseout\", this.tip.hide);\n\n  this.svg.append(\"path\").datum(topojson.mesh(this.ga, this.ga.objects.county, function (a, b) {\n    return a != b;\n  })).attr(\"class\", \"county\").attr(\"d\", this.path);\n};\n\nChart.prototype.drawCounty = function () {\n  var _this = this;\n\n  this.element.innerHTML = '';\n  this.svg = d3.select(this.element).append('svg');\n  this.svg.attr('width', this.width);\n  this.svg.attr('height', this.height);\n  this.svg.call(this.tip);\n  this.svg.append(\"g\").attr(\"class\", \"county\").selectAll(\"path\").data(topojson.feature(this.ga, this.ga.objects.county).features).enter().append(\"path\").attr(\"fill\", function (d) {\n    return _this.color(_this.data.get(d.properties.GEOID));\n  }).attr(\"d\", this.path).on(\"mouseover\", this.tip.show).on(\"mouseout\", this.tip.hide).on(\"click\", function (d) {\n    console.log(d.properties.GEOID);\n    window.open(\"./tabulate.html?GEOID=\" + d.properties.GEOID + \"=name=\" + d.properties.NAME);\n  });\n};\n\nChart.prototype.addContinousLegend = function () {\n  var colorScale1 = d3.scaleLinear().range([\"#DEEDCF\", \"#39A96B\"]).domain(d3.extent(this.data.values())).interpolate(d3.interpolateLab);\n  continuous(\"#legend1\", colorScale1); // create continuous color legend\n\n  function continuous(selector_id, colorscale) {\n    var legendheight = 200,\n        legendwidth = 80,\n        margin = {\n      top: 10,\n      right: 60,\n      bottom: 10,\n      left: 2\n    };\n    d3.select(selector_id).selectAll(\"*\").remove();\n    var canvas = d3.select(selector_id).style(\"height\", legendheight + \"px\").style(\"width\", legendwidth + \"px\").style(\"position\", \"relative\").append(\"canvas\").attr(\"height\", legendheight - margin.top - margin.bottom).attr(\"width\", 1).style(\"height\", legendheight - margin.top - margin.bottom + \"px\").style(\"width\", legendwidth - margin.left - margin.right + \"px\").style(\"border\", \"1px solid #000\").style(\"position\", \"absolute\").style(\"top\", margin.top + \"px\").style(\"left\", margin.left + \"px\").node();\n    var ctx = canvas.getContext(\"2d\");\n    var legendscale = d3.scaleLinear().range([1, legendheight - margin.top - margin.bottom]).domain(colorscale.domain()); // image data hackery based on http://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5\n\n    var image = ctx.createImageData(1, legendheight);\n    d3.range(legendheight).forEach(function (i) {\n      var c = d3.rgb(colorscale(legendscale.invert(i)));\n      image.data[4 * i] = c.r;\n      image.data[4 * i + 1] = c.g;\n      image.data[4 * i + 2] = c.b;\n      image.data[4 * i + 3] = 255;\n    });\n    ctx.putImageData(image, 0, 0);\n    var legendaxis = d3.axisRight().scale(legendscale).tickSize(6).ticks(8);\n    var svg = d3.select(selector_id).append(\"svg\").attr(\"height\", legendheight + \"px\").attr(\"width\", legendwidth + 10 + \"px\").style(\"position\", \"absolute\").style(\"left\", \"0px\").style(\"top\", \"0px\");\n    svg.append(\"g\").attr(\"class\", \"axis\").attr(\"transform\", \"translate(\" + (legendwidth - margin.left - margin.right + 3) + \",\" + margin.top + \")\").call(legendaxis);\n    svg.append(\"text\").attr(\"x\", 50).attr(\"y\", 190).text(\"highest\").style(\"font-size\", \"12px\").style('fill', \"black\").attr(\"alignment-baseline\", \"middle\");\n    svg.append(\"text\").attr(\"x\", 50).attr(\"y\", 15).text(\"lowest\").style(\"font-size\", \"12px\").style('fill', \"black\").attr(\"alignment-baseline\", \"middle\");\n  }\n};\n\nChart.prototype.addLegend = function () {\n  var _this = this;\n\n  this.legend = this.svg.selectAll(\"g.legendEntry\").data(this.color.range().reverse()).enter().append(\"g\").attr(\"class\", \"legendEntry\");\n  this.legend.append(\"rect\").attr(\"x\", this.width / 1.5).attr(\"y\", function (d, i) {\n    return i * 20 + 10;\n  }).attr(\"width\", 15).attr(\"height\", 15).style(\"stroke\", \"black\").style(\"stroke-width\", 1).style(\"fill\", function (d) {\n    return d;\n  });\n  this.legend.append(\"text\").attr(\"x\", this.width / 1.5 + 20).attr(\"y\", function (d, i) {\n    return i * 20 + 12;\n  }).attr(\"dy\", \"0.8em\").text(function (d, i) {\n    var extent = _this.color.invertExtent(d);\n\n    var format = d3.format(_this.fmt);\n    return format(+extent[0]) + \" - \" + format(+extent[1]) + \" \" + _this.unit;\n  });\n};\n\nChart.prototype.setData = function (data) {\n  this.data = data;\n  this.draw();\n};","map":{"version":3,"sources":["/Users/lisasun/Documents/Dashboard/MondoDB/portal_new/stitch-tutorial-todo-web/src/components/map.js"],"names":["d3","Chart","opts","data","ga","element","draw","prototype","width","offsetWidth","height","has","unitStr","get","split","unit","fmt","remove","each","value","key","set","setProjection","setColor","addTooltip","keys","drawTract","drawCounty","addContinousLegend","projection","geoTransverseMercator","rotate","scale","translate","path","geoPath","color","scaleLinear","range","domain","extent","values","interpolate","interpolateLab","_this","innerHTML","svg","select","append","attr","call","tip","selectAll","topojson","feature","objects","tract","features","enter","d","properties","GEOID","datum","mesh","county","a","b","on","show","hide","console","log","window","open","NAME","colorScale1","continuous","selector_id","colorscale","legendheight","legendwidth","margin","top","right","bottom","left","canvas","style","node","ctx","getContext","legendscale","image","createImageData","forEach","i","c","rgb","invert","r","g","putImageData","legendaxis","axisRight","tickSize","ticks","text","addLegend","legend","reverse","invertExtent","format","setData"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\"\nimport \"./topojson.v2.min\"\n\nvar Chart = function(opts) {\n    this.data = opts.data;\n    this.ga = opts.ga;\n    this.element = opts.element;\n\n    this.draw();\n};\n\nChart.prototype.draw = function() {\n    this.width = this.element.offsetWidth;\n    this.height = this.width * 1.1;\n\n    if (this.data.has(\"unit\")) {\n        var unitStr = this.data.get(\"unit\").split(\"-\");\n        this.unit = unitStr[0];\n        this.fmt = unitStr[1];\n        this.data.remove(\"unit\");\n\n        this.data.each(function(value, key, data) { data.set(key, +value); });\n    }\n\n    this.setProjection();\n    this.setColor();\n    this.addTooltip();\n\n    if (this.data.keys()[0] > 100000) {\n        this.drawTract();\n    } else {\n        this.drawCounty();\n    }\n\n    // this.addLegend();\n    this.addContinousLegend();\n\n};\n\nChart.prototype.setProjection = function() {\n    this.projection = d3.geoTransverseMercator()\n        .rotate([84 + 10 / 60, -30])\n        .scale(this.width * 13)\n        .translate([this.width / 3.1, this.height / 0.95]);\n\n    this.path = d3.geoPath()\n        .projection(this.projection);\n};\n\nChart.prototype.setColor = function() {\n    // this.color = d3.scaleQuantize()\n    //     .domain(d3.extent(this.data.values()))\n    //     .range([\"#DEEDCF\", \"#BFE1B0\", \"#99D492\", \"#74C67A\", \"#56B870\", \"#39A96B\"]);\n        // .range(d3.schemeBlues[6]);\n    this.color = d3.scaleLinear()\n          .range([\"#DEEDCF\", \"#39A96B\"])\n          .domain(d3.extent(this.data.values()))\n          .interpolate(d3.interpolateLab);\n\n\n};\n\n// Chart.prototype.addTooltip = function() {\n//     var _this = this;\n//     d3.selectAll(\".d3-tip-\" + this.element.id).remove();\n\n//     this.tip = d3.tip()\n//         .attr(\"class\", \"d3-tip-\" + this.element.id)\n//         .html(function(d) {\n//             if (+d.properties.GEOID < 100000) {\n//                 return d.properties.NAME + \" County</br>\" + d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit + \"</br> (click for more details)\";\n//             } else {\n//                 return d.properties.GEOID + \": \" + d3.format(_this.fmt)(_this.data.get(d.properties.GEOID)) + \" \" + _this.unit;\n//             }\n//         });\n// };\n\nChart.prototype.drawTract = function() {\n    var _this = this;\n\n    this.element.innerHTML = '';\n    this.svg = d3.select(this.element).append('svg');\n    this.svg.attr('width', this.width);\n    this.svg.attr('height', this.height);\n    this.svg.call(this.tip);\n\n    this.svg.append(\"g\")\n        .attr(\"class\", \"tract\")\n        .selectAll(\"path\")\n        .data(topojson.feature(this.ga, this.ga.objects.tract).features)\n        .enter().append(\"path\")\n        .attr(\"fill\", function(d) { return _this.color(_this.data.get(d.properties.GEOID)); })\n        .attr(\"d\", this.path)\n        // .on(\"mouseover\", this.tip.show)\n        // .on(\"mouseout\", this.tip.hide);\n\n    this.svg.append(\"path\")\n        .datum(topojson.mesh(this.ga, this.ga.objects.county, function(a, b) { return a != b; }))\n        .attr(\"class\", \"county\")\n        .attr(\"d\", this.path);\n};\n\nChart.prototype.drawCounty = function() {\n    var _this = this;\n\n    this.element.innerHTML = '';\n    this.svg = d3.select(this.element).append('svg');\n    this.svg.attr('width', this.width);\n    this.svg.attr('height', this.height);\n    this.svg.call(this.tip);\n\n    this.svg.append(\"g\")\n        .attr(\"class\", \"county\")\n        .selectAll(\"path\")\n        .data(topojson.feature(this.ga, this.ga.objects.county).features)\n        .enter().append(\"path\")\n        .attr(\"fill\", function(d) { return _this.color(_this.data.get(d.properties.GEOID)); })\n        .attr(\"d\", this.path)\n        .on(\"mouseover\", this.tip.show)\n        .on(\"mouseout\", this.tip.hide)\n        .on(\"click\", function(d) {\n            console.log(d.properties.GEOID);\n            window.open(\"./tabulate.html?GEOID=\" + d.properties.GEOID+ \"=name=\" + d.properties.NAME); });\n};\n\nChart.prototype.addContinousLegend = function() {\n    var colorScale1 = d3\n        .scaleLinear()\n          .range([\"#DEEDCF\", \"#39A96B\"])\n          .domain(d3.extent(this.data.values()))\n          .interpolate(d3.interpolateLab);\n    continuous(\"#legend1\", colorScale1);\n    // create continuous color legend\n    function continuous(selector_id, colorscale) {\n      var legendheight = 200,\n          legendwidth = 80,\n          margin = {top: 10, right: 60, bottom: 10, left: 2};\n    d3.select(selector_id).selectAll(\"*\").remove();\n\n      var canvas = d3.select(selector_id)\n        .style(\"height\", legendheight + \"px\")\n        .style(\"width\", legendwidth + \"px\")\n        .style(\"position\", \"relative\")\n        .append(\"canvas\")\n        .attr(\"height\", legendheight - margin.top - margin.bottom)\n        .attr(\"width\", 1)\n        .style(\"height\", (legendheight - margin.top - margin.bottom) + \"px\")\n        .style(\"width\", (legendwidth - margin.left - margin.right) + \"px\")\n        .style(\"border\", \"1px solid #000\")\n        .style(\"position\", \"absolute\")\n        .style(\"top\", (margin.top) + \"px\")\n        .style(\"left\", (margin.left) + \"px\")\n        .node();\n\n\n      var ctx = canvas.getContext(\"2d\");\n\n      var legendscale = d3.scaleLinear()\n        .range([1, legendheight - margin.top - margin.bottom])\n        .domain(colorscale.domain());\n\n      // image data hackery based on http://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5\n      var image = ctx.createImageData(1, legendheight);\n      d3.range(legendheight).forEach(function(i) {\n        var c = d3.rgb(colorscale(legendscale.invert(i)));\n        image.data[4*i] = c.r;\n        image.data[4*i + 1] = c.g;\n        image.data[4*i + 2] = c.b;\n        image.data[4*i + 3] = 255;\n      });\n      ctx.putImageData(image, 0, 0);\n\n      var legendaxis = d3.axisRight()\n        .scale(legendscale)\n        .tickSize(6)\n        .ticks(8);\n\n      var svg = d3.select(selector_id)\n        .append(\"svg\")\n        .attr(\"height\", (legendheight) + \"px\")\n        .attr(\"width\", (legendwidth + 10) + \"px\")\n        .style(\"position\", \"absolute\")\n        .style(\"left\", \"0px\")\n        .style(\"top\", \"0px\")\n\n      svg\n        .append(\"g\")\n        .attr(\"class\", \"axis\")\n        .attr(\"transform\", \"translate(\" + (legendwidth - margin.left - margin.right + 3) + \",\" + (margin.top) + \")\")\n        .call(legendaxis);\n\n      svg\n        .append(\"text\")\n        .attr(\"x\", 50)\n        .attr(\"y\", 190)\n        .text(\"highest\")\n        .style(\"font-size\", \"12px\")\n        .style('fill', \"black\")\n        .attr(\"alignment-baseline\",\"middle\");\n\n      svg\n      .append(\"text\")\n      .attr(\"x\", 50)\n      .attr(\"y\", 15)\n      .text(\"lowest\")\n      .style(\"font-size\", \"12px\")\n      .style('fill', \"black\")\n      .attr(\"alignment-baseline\",\"middle\");\n    }\n}\n\nChart.prototype.addLegend = function() {\n    var _this = this;\n\n    this.legend = this.svg.selectAll(\"g.legendEntry\")\n        .data(this.color.range().reverse())\n        .enter()\n        .append(\"g\").attr(\"class\", \"legendEntry\");\n\n    this.legend.append(\"rect\")\n        .attr(\"x\", this.width / 1.5)\n        .attr(\"y\", function(d, i) {\n            return i * 20 + 10;\n        })\n        .attr(\"width\", 15)\n        .attr(\"height\", 15)\n        .style(\"stroke\", \"black\")\n        .style(\"stroke-width\", 1)\n        .style(\"fill\", function(d) {return d;});\n\n    this.legend.append(\"text\")\n        .attr(\"x\", this.width / 1.5 + 20)\n        .attr(\"y\", function(d, i) {\n            return i * 20 + 12;\n        })\n        .attr(\"dy\", \"0.8em\")\n        .text(function(d, i) {\n            var extent = _this.color.invertExtent(d);\n            var format = d3.format(_this.fmt);\n            return format(+extent[0]) + \" - \" + format(+extent[1]) + \" \" + _this.unit;\n        });\n};\n\nChart.prototype.setData = function(data) {\n    this.data = data;\n    this.draw();\n};\n"]},"metadata":{},"sourceType":"module"}